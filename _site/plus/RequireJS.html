<!DOCTYPE html><!--[if lt IE 7]>
<html lang="en" class="ie ie6"></html><![endif]--><!--[if IE 7]>
<html lang="en" class="ie ie7"></html><![endif]--><!--[if IE 8]>
<html lang="en" class="ie ie8"></html><![endif]--><!--[if (gte IE 9)|!(IE)]>
<html lang="en"></html>
<head>
  <!-- head.jade -->
  <!---->
  <!-- This this the template for the head part.-->
  <!-- Basic Page Needs-->
  <meta charset="utf-8">
  <title>RequireJS</title>
  <!-- Mobile specific Metas-->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <!-- Le styles -->
  <link href="/css/app.css" rel="stylesheet">
  <!-- HTML5 shim, for IE6-8 support of HTML5 elements --><!--[if lt IE 9]>
  <script src="/js/html5.js"></script><![endif]-->
  <!-- Fav and touch icons -->
  <link rel="shortcut icon" href="/images/favicon/favicon.ico">
  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png">
</head>
<body>
  <div id="wrap" class="boxed">
    <header>
      <div class="container clearfix">
        <div class="one-third column">
          <div class="logo"><a href="/"><img src="/images/logo_light.png" alt="Testacular"></a></div>
        </div>
        <div class="two-thirds column">
          <nav id="menu" class="navigation">
            <ul id="nav">
              <li><a href="javascript:void">about</a>
                <ul>
                  <li><a href="/about/changelog.html">Changelog</a></li>
                  <li><a href="/about/versioning.html">Versioning</a></li>
                </ul>
              </li>
              <li><a href="javascript:void">dev</a>
                <ul>
                  <li><a href="/dev/msg.html">Git Commit Message Convention</a></li>
                  <li><a href="/dev/contributing.html">How to contribute</a></li>
                  <li><a href="/dev/API.html">Public API</a></li>
                </ul>
              </li>
              <li><a href="javascript:void">plus</a>
                <ul>
                  <li><a href="/plus/Teamcity.html">Teamcity</a></li>
                  <li><a href="/plus/RequireJS.html">RequireJS</a></li>
                  <li><a href="/plus/Cloud9.html">Cloud9 IDE Integration</a></li>
                  <li><a href="/plus/CI.html">Jenkins CI Integration</a></li>
                  <li><a href="/plus/AngularJS.html">AngularJS</a></li>
                </ul>
              </li>
              <li><a href="javascript:void">config</a>
                <ul>
                  <li><a href="/config/preprocessors.html">Preprocessors</a></li>
                  <li><a href="/config/files.html">Files</a></li>
                  <li><a href="/config/file.html">Configuration File</a></li>
                  <li><a href="/config/coverage.html">Coverage Reporter</a></li>
                  <li><a href="/config/browsers.html">Browsers</a></li>
                </ul>
              </li>
              <li><a href="javascript:void">intro</a>
                <ul>
                  <li><a href="/intro/why.html">Why?</a></li>
                  <li><a href="/intro/troubleshooting.html">Troubleshooting</a></li>
                  <li><a href="/intro/installation.html">Installation</a></li>
                  <li><a href="/intro/configuration.html">Configuration</a></li>
                </ul>
              </li> 
              <li><a href="">0.6.0</a>
                <ul>
                  <li> <a href="">0.6.0</a></li>
                </ul>
              </li>
            </ul>
          </nav>
        </div>
        <div class="sixteen columns">
          <hr>
        </div>
      </div>
    </header>
    <div class="container clearfix">
      <div class="sixteen columns">
        <h1 class="page-title">RequireJS<span class="line"></span></h1>
      </div>
      <div class="page-columns">
        <div id="markdown" class="sixteen columns bottom"><h1 id="toc_0">RequireJS</h1>

<h2 id="toc_1">Configure Testacular</h2>

<h3 id="toc_2">Directory Setup</h3>

<p>For clarity in the example configuration files and test below, the directory structure upon which these are based looks like this:</p>
<div class="highlight"><pre><code class="text">project/
  lib/
    jquery.js #etc
  node_modules/
    chai/ #etc
  src/
    MyModule.js
  test/
    MyModule.test.js
    test-main.js
testacular.conf.js
</code></pre></div>
<h3 id="toc_3">Initialize Testacular</h3>

<p>Testacular comes with a nice utility for generating a config file (default name: <code>testacular.conf.js</code>) that it needs in order to run. In your terminal, type:</p>
<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>testacular init
</code></pre></div>
<p>This will give you a series of prompts for things such as paths to source and tests and which browsers to capture. These prompts do not include the option to add RequireJs support automatically, so you’ll need to add those lines manually to your <code>testacular.conf.js</code> (see below). As of testacular 0.5.2, testacular init will prompt for usage of the RequireJs adapter.</p>

<h3 id="toc_4">Testacular Include</h3>

<p>Testacular 0.5.1 (**WARNING** As of writing, npm install will give you 0.4.0, the latest stable version) This, while adding RequireJs support, has added a new concept of “included” to the files listed in your config. This is because RequireJs will balk about a the module not being loaded correctly (ie, loaded synchronously in the <code>&lt;head/&gt;</code> tag of the runner). From the RequireJs docs:</p>

<blockquote>
<p>Be sure to load all scripts that call <code>define()</code> via the RequireJS API. Do not manually code script tags 
in HTML to load scripts that have <code>define()</code> calls in them.</p>
</blockquote>

<h3 id="toc_5">RequireJs Shim</h3>

<p>Not immediately apparent is the fact that the ‘shim’ config from RequireJs 2.x does not work from within Testacular. I haven’t yet figured out why. For instance, I was constantly getting “‘Backbone’ is not defined” messages even though it was specified in the ‘shim’ config and required in the test. I could have been doing something wrong. My solution thus far has been to list each of the non-RequireJs modules and their dependencies in the <code>files</code> attribute of <code>testacular.conf.js</code>.</p>

<h3 id="toc_6"><code>testacular.conf.js</code></h3>

<p>The final point is that the RequireJs main module for your test runner should be the last file listed.</p>

<p>So, finally, here is the ‘file’ excerpt of <code>testacular.conf.js</code>:</p>
<div class="highlight"><pre><code class="javascript"><span class="nx">files</span> <span class="o">=</span> <span class="p">[</span>
  <span class="nx">MOCHA</span><span class="p">,</span>
  <span class="nx">MOCHA_ADAPTER</span><span class="p">,</span>
  <span class="nx">REQUIRE</span><span class="p">,</span>
  <span class="nx">REQUIRE_ADAPTER</span><span class="p">,</span>

  <span class="c1">// !! libs required for test framework</span>
  <span class="p">{</span><span class="nx">pattern</span><span class="o">:</span> <span class="s1">&#39;node_modules/chai/chai.js&#39;</span><span class="p">,</span> <span class="nx">included</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span>

  <span class="c1">// !! put what used to be in your requirejs &#39;shim&#39; config here</span>
  <span class="s1">&#39;lib/jquery.js&#39;</span><span class="p">,</span>
  <span class="s1">&#39;lib/underscore.js&#39;</span><span class="p">,</span>
  <span class="s1">&#39;lib/backbone.js&#39;</span><span class="p">,</span>
  <span class="s1">&#39;lib/handlebars.js&#39;</span><span class="p">,</span>

  <span class="c1">// !! put all libs in requirejs &#39;paths&#39; config here (included: false)</span>
  <span class="p">{</span><span class="nx">pattern</span><span class="o">:</span> <span class="s1">&#39;lib/**/*.js&#39;</span><span class="p">,</span> <span class="nx">included</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span>

  <span class="c1">// !! all src and test modules (included: false)</span>
  <span class="p">{</span><span class="nx">pattern</span><span class="o">:</span> <span class="s1">&#39;src/**/*&#39;</span><span class="p">,</span> <span class="nx">included</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">pattern</span><span class="o">:</span> <span class="s1">&#39;test/**/*.test.js&#39;</span><span class="p">,</span> <span class="nx">included</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span>

  <span class="c1">// !! test main require module last</span>
  <span class="s1">&#39;test/test-main.js&#39;</span>
<span class="p">];</span>
</code></pre></div>
<p>This config is awesome. It replaces an html test runner that you would otherwise have to build.</p>

<h2 id="toc_7">RequireJs Main Module</h2>

<p>Just like any RequireJs project, you need a main module to bootstrap your tests. In the main module, you setup the <code>require.config</code>.</p>

<h3 id="toc_8">Testacular <code>/base</code> Directory</h3>

<p>Testacular serves files under the <code>/base</code> directory. So, on the server, requests to files will be served up under <code>http://localhost:9876/base/*</code>. The RequireJs config for <code>baseUrl</code> gives a starting context for modules that load with relative paths. When setting this value for the Testacular server, it will need to start with <code>/base</code>. I want my baseUrl to be at the root of my <code>/src</code> directory so relative requires in the source won’t need to change. My baseUrl has the value of <code>/base/src</code>.</p>

<h3 id="toc_9">Require Each Test File</h3>

<p>One of the things I hate is having to update a master list of all tests to run every time I add a test. There is no config option for this, but there&#39;s an easy way to get around it by filtering the tests from the <code>window.__testacular__.files</code> object.
The code is included in the example below and the original suggestion came from <a href="https://github.com/vojtajina/testacular/pull/236">https://github.com/vojtajina/testacular/pull/236</a>.</p>

<h3 id="toc_10">Asynchronously Run Testacular</h3>

<p>Because the RequireJs require statements are asynchronous, Testacular needs to wait until they’re done (the code is loaded and ready) before it starts the tests.</p>

<p>The main-test.js file ends up looking like this:</p>
<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">tests</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">__testacular__</span><span class="p">.</span><span class="nx">files</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="sr">/\.test\.js$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">require</span><span class="p">({</span>

  <span class="c1">// !! Testacular serves files from &#39;/base&#39;</span>
  <span class="nx">baseUrl</span><span class="o">:</span> <span class="s1">&#39;/base/src&#39;</span><span class="p">,</span>
  <span class="nx">paths</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">require</span><span class="o">:</span> <span class="s1">&#39;../lib/require&#39;</span><span class="p">,</span>
    <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;../lib/text&#39;</span>
  <span class="p">},</span>
<span class="p">},</span> <span class="nx">tests</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">__testacular__</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>
<h2 id="toc_11">RequireJs Test in Testacular</h2>

<p>All the setup thus far has been in preparation for the code to follow. The test can now be setup as a RequireJs module. It can require the source code under test. It can use Mocha (or whatever framework there is a Testacular adapter for).</p>

<p>I will also use Chai in order to get the ‘should’ BDD-style assertions. Note that by using RequireJs and running in the browser, we can’t just <code>require(&#39;chai&#39;)</code>. It has to be required using the asynchronous callback to avoid this error:</p>
<div class="highlight"><pre><code class="bash">Uncaught Error: Module name “../node_modules/chai/chai” has not been loaded yet <span class="k">for </span>context: _. Use require<span class="o">([])</span>
</code></pre></div>
<p>And finally, <code>should()</code> must be invoked to be available in the test.</p>

<p>So, a simple test will look like:</p>
<div class="highlight"><pre><code class="javascript"><span class="nx">define</span><span class="p">([</span><span class="s1">&#39;../node_modules/chai/chai&#39;</span><span class="p">,</span> <span class="s1">&#39;MyModule&#39;</span><span class="p">],</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">chai</span><span class="p">,</span> <span class="nx">MyModule</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">assert</span> <span class="o">=</span> <span class="nx">chai</span><span class="p">.</span><span class="nx">assert</span><span class="p">,</span>
    <span class="nx">expect</span> <span class="o">=</span> <span class="nx">chai</span><span class="p">.</span><span class="nx">expect</span><span class="p">,</span>
    <span class="nx">should</span> <span class="o">=</span> <span class="nx">chai</span><span class="p">.</span><span class="nx">should</span><span class="p">();</span>

  <span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;MyModule&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;#initialize()&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should be a stinkin object&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">yippee</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyModule</span><span class="p">();</span>
        <span class="nx">yippee</span><span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">an</span><span class="p">(</span><span class="s1">&#39;object&#39;</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<h2 id="toc_12">Run the Tests in Testacular</h2>

<p>To start the Testacular server:</p>
<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>testacular start
</code></pre></div>
<p>Finally, if your Testacular server is already running and you want to kick off the tests, type:</p>
<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>testacular run
</code></pre></div>
<hr>

<p>Source: <a href="http://jaketrent.com/post/test-requirejs-testacular/">Jake Trent</a></p>
</div>
      </div>
    </div>
    <div class="push"></div>
  </div>
  <footer>
    <div class="container">
      <div class="ten columns"><span class="copyright"><a href="https://github.com/testacular/testacular">Testacular</a>&nbsp;is released under the<a href="https://github.com/testacular/testacular/blob/master/LICENSE" target="_blank">
             
            MIT license</a>. Site by&nbsp;<a href="https://github.com/Dignifiedquire" target="_blank">Friedel Ziegelmayer</a>.</span></div>
      <div class="six columns">
        <div class="social"><a href="https://github.com/vojtajina/testacular/" data-tooltip="GitHub Repo"><i class="icon-github-alt icon-large"></i></a><a href="https://github.com/vojtajina/testacular/issues" data-tooltip="Issues"><i class="icon-beaker icon-large"></i></a><a href="http://twitter.com/TestacularJS" data-tooltip="@TestacularJS"><i class="icon-twitter icon-large"></i></a><a href="https://groups.google.com/forum/#!forum/testacular" data-tooltip="Mailing List"><i class="icon-envelope-alt icon-large"></i></a></div>
      </div>
    </div>
  </footer>
</body>
<!-- Placed at the end of the document so the pages load faster -->
<script src="/javascript/app.js">;</script><![endif]-->